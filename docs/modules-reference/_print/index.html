<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.80.0" /><link rel="canonical" type="text/html" href="/docs/modules-reference/">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Modues reference | Opta</title><meta property="og:title" content="Modues reference" />
<meta property="og:description" content="Opta config reference
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/modules-reference/" />
<meta property="og:site_name" content="Opta" />
<meta itemprop="name" content="Modues reference">
<meta itemprop="description" content="Opta config reference
">
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Modues reference"/>
<meta name="twitter:description" content="Opta config reference
"/>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-188763285-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>






<link rel="preload" href="/scss/main.min.a4f4923899f9878a84cfd83f594a4cec69ffb2fa0e75cb0d777edae060863ead.css" as="style">
<link href="/scss/main.min.a4f4923899f9878a84cfd83f594a4cec69ffb2fa0e75cb0d777edae060863ead.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>


<script type="text/javascript">
    (function(e,t){var n=e.amplitude||{_q:[],_iq:{}};var r=t.createElement("script")
    ;r.type="text/javascript"
    ;r.integrity="sha384-girahbTbYZ9tT03PWWj0mEVgyxtZoyDF9KVZdL+R53PP5wCY0PiVUKq0jeRlMx9M"
    ;r.crossOrigin="anonymous";r.async=true
    ;r.src="https://cdn.amplitude.com/libs/amplitude-7.2.1-min.gz.js"
    ;r.onload=function(){if(!e.amplitude.runQueuedFunctions){
        console.log("[Amplitude] Error: could not load SDK")}}
    ;var i=t.getElementsByTagName("script")[0];i.parentNode.insertBefore(r,i)
    ;function s(e,t){e.prototype[t]=function(){
        this._q.push([t].concat(Array.prototype.slice.call(arguments,0)));return this}}
        var o=function(){this._q=[];return this}
        ;var a=["add","append","clearAll","prepend","set","setOnce","unset"]
        ;for(var u=0;u<a.length;u++){s(o,a[u])}n.Identify=o;var c=function(){this._q=[]
            ;return this}
        ;var l=["setProductId","setQuantity","setPrice","setRevenueType","setEventProperties"]
        ;for(var p=0;p<l.length;p++){s(c,l[p])}n.Revenue=c
        ;var d=["init","logEvent","logRevenue","setUserId","setUserProperties","setOptOut","setVersionName","setDomain","setDeviceId", "enableTracking", "setGlobalUserProperties","identify","clearUserProperties","setGroup","logRevenueV2","regenerateDeviceId","groupIdentify","onInit","logEventWithTimestamp","logEventWithGroups","setSessionId","resetSessionId"]
        ;function v(e){function t(t){e[t]=function(){
            e._q.push([t].concat(Array.prototype.slice.call(arguments,0)))}}
            for(var n=0;n<d.length;n++){t(d[n])}}v(n);n.getInstance=function(e){
            e=(!e||e.length===0?"$default_instance":e).toLowerCase()
            ;if(!n._iq.hasOwnProperty(e)){n._iq[e]={_q:[]};v(n._iq[e])}return n._iq[e]}
        ;e.amplitude=n})(window,document);

    amplitude.getInstance().init("3c2edcd34808a6431499f4cd9b034e34");

    amplitude.getInstance().logEvent("Viewed " + document.title + " Page", {
        url: window.location.href,
    });
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />



  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg width="113" height="32" viewBox="0 0 113 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.4425 25.3675 7.86982 20.2459C7.71992 20.2625 7.49507 20.2709 7.19527 20.2709H3.24786V25.3675H0V7.87903H7.19527C8.71093 7.87903 10.0267 8.12886 11.1427 8.62854 12.2753 9.12821 13.1414 9.8444 13.741 10.7771 14.3406 11.7098 14.6404 12.8174 14.6404 14.0999 14.6404 15.4157 14.3156 16.5483 13.666 17.4977 13.0331 18.4471 12.117 19.1549 10.9178 19.6213L14.9402 25.3675H11.4425zM11.3675 14.0999C11.3675 12.984 11.0011 12.1262 10.2682 11.5266 9.53539 10.927 8.4611 10.6272 7.04536 10.6272H3.24786v6.9704H7.04536C8.4611 17.5976 9.53539 17.2978 10.2682 16.6982 11.0011 16.082 11.3675 15.2159 11.3675 14.0999z" fill="#fff"/><path d="M29.7915 25.6174C27.3765 25.6174 25.4944 24.9428 24.1452 23.5937 22.7961 22.2279 22.1216 20.2792 22.1216 17.7475V7.87903H25.3694V17.6226C25.3694 21.0537 26.8518 22.7692 29.8165 22.7692 32.7646 22.7692 34.2386 21.0537 34.2386 17.6226V7.87903H37.4365V17.7475C37.4365 20.2792 36.7619 22.2279 35.4128 23.5937 34.0804 24.9428 32.2066 25.6174 29.7915 25.6174z" fill="#fff"/><path d="M61.5222 7.87903V25.3675H58.849L49.2053 13.5253V25.3675H45.9824V7.87903H48.6557L58.2993 19.7212V7.87903H61.5222z" fill="#fff"/><path d="M96.8415 25.3675 93.2189 19.9461 89.6463 25.3675H84L90.3708 16.5233 84.2748 7.87903H89.8461L93.3438 12.9257 96.7916 7.87903H102.138L96.0421 16.3235 102.538 25.3675H96.8415z" fill="#fff"/><path d="M107.453 32V30.5299H111.248V1.47008H107.453V0H112.957V32H107.453z" fill="#fe794f"/><path d="M72.5.0H78.0043V1.47009H74.2094V30.5299H78.0043V32H72.5V0z" fill="#fe794f"/></svg></span><span class="text-uppercase font-weight-bold">Opta</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a  class="nav-link active" href="/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
<input type="search" class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete="off">

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/docs/modules-reference/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Modues reference</h1>
<div class="lead">Opta config reference</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-e9dfe91c9afb5ff49c25d4272db6709a">Environment modules</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-8b65a7f9c654579631b4e0819aa048df">AWS environment modules</a></li>


    
  
    
    
	
<li>1.2: <a href="#pg-b02d26f6c20395131bdf4246898f743a">GCP environment modules</a></li>


    
  
    
    
	
<li>1.3: <a href="#pg-3525fa571dc1c25f855af7e3f2060b89">Cloud agnostic environment modules</a></li>


    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-17f62f7e9a70bad68895e6447344b83a">Service modules</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-d13b5dc21fdb391688377e7ca5945001">AWS service modules</a></li>


    
  
    
    
	
<li>2.2: <a href="#pg-0f95dcc211c00d06f7f821a5c6acfcf1">GCP service modules</a></li>


    
  

    </ul>
    
  

    </ul>


<div class="content">
      <h1 id="whats-an-opta-module">What&rsquo;s an Opta module?</h1>
<p>The heart of Opta is a set of &ldquo;Modules&rdquo; which basically map to AWS resources that
need to get created. Opta yamls reference these under the <code>modules</code> field.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">myapp</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">environments</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">staging</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">parent</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;../env/opta.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">modules</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">app</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># This is an instance of the k8-service module type called app</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">k8s-service</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">http</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">80</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">AUTO</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">public_uri</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;app.{parent.domain}/app&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">resource_request</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">cpu</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># in millicores</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">512</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># in megabytes</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">healthcheck_path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;/get&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">env_vars</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ENV</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;{env}&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">links</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">rds</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">redis</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">rds</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># This is an instance of the aws-rds module type called mydatabase</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws-postgres</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">redis</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># This is an instance of the aws-redis module type called myredis</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws-redis</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>You&rsquo;ll note that the module instance can have user-specified names which will come into play later with references.
Opta modules are composed of the following entities/behaviors:</p>
<h2 id="fields">Fields</h2>
<p>You&rsquo;ll note that there can be many, varying, fields per module instance such
as &ldquo;type&rdquo;, &ldquo;env_vars&rdquo;, &ldquo;image&rdquo; etc&hellip;  These are called <em>fields</em> and this
is how specific data is passed into the modules.</p>
<h3 id="names">Names</h3>
<p>All modules have a name field, which is used to create the name of the cloud resources in conjunction with the layer
name (root name of opta.yml). A user can specify this with the <code>name</code> field, but it defaults to the module type (without
the hyphens) if not given.</p>
<h3 id="types">Types</h3>
<p>All modules have their own list of supported fields, but the one common to all is <em>type</em>. The type field is simply
the module reference (e.g. the library/package to use in this &ldquo;import&rdquo;). Opta currently comes with its list of valid
modules built in &ndash; future work may allow users to specify their own.</p>
<h3 id="linking">Linking</h3>
<p>The k8s-service module type is the first (but not the last) module to support
special processing. In this case, it&rsquo;s in regard to the <em>links</em> field. The
links field takes as input a list of maps with a single element where the
key is the name of another module in the file, and the value a list of
strings representing resource permissions.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">myapp</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">environments</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">staging</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">parent</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;../env/opta.yml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">modules</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">app</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># This is an instance of the k8-service module type called app</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">.</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">.</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">.</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">links</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">rds</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">redis</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">docdb</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">bucket</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">write</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">rds</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># This is an instance of the aws-rds module type called database</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws-postgres</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">redis</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># This is an instance of the aws-redis module type called redis</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws-redis</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">docdb</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws-documentdb</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bucket</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">aws-s3</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">bucket_name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;test-bucket&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div>
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e9dfe91c9afb5ff49c25d4272db6709a">1 - Environment modules</h1>
    
	<p>This section provides the list of module types for the user to use in an environment opta yaml (a root one with no environments on top specified), with their inputs and outputs.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-8b65a7f9c654579631b4e0819aa048df">1.1 - AWS environment modules</h1>
    
	<h2 id="aws-base">aws-base</h2>
<p>This module is the &ldquo;base&rdquo; module for creating an environment in aws. It sets up the VPCs, default kms key and the
db/cache subnets. Defaults are set to work 99% of the time, assuming no funny networking constraints (you&rsquo;ll know them
if you have them), so <em>no need to set any of the fields or know what the outputs do</em>.</p>
<p><em>Fields</em></p>
<ul>
<li><code>total_ipv4_cidr_block</code> &ndash; Optional. This is the total cidr block for the VPC. Defaults to &ldquo;10.0.0.0/16&rdquo;</li>
<li><code>private_ipv4_cidr_blocks</code> &ndash; Optional. These are the cidr blocks to use for the private subnets, one for each AZ.
Defaults to [&ldquo;10.0.128.0/21&rdquo;, &ldquo;10.0.136.0/21&rdquo;, &ldquo;10.0.144.0/21&rdquo;]</li>
<li><code>public_ipv4_cidr_blocks</code> &ndash; Optional. These are the cidr blocks to use for the public subnets, one for each AZ.
Defaults to [&ldquo;10.0.0.0/21&rdquo;, &ldquo;10.0.8.0/21&rdquo;, &ldquo;10.0.16.0/21&rdquo;]</li>
</ul>
<p><em>Outputs</em></p>
<ul>
<li><code>kms_account_key_arn</code> &ndash; The <a href="https://docs.aws.amazon.com/general/latest/gr/aws-arns-and-namespaces.html">ARN</a> of the default
<a href="https://aws.amazon.com/kms/">KMS</a> key (this is what handles encryption for redis, documentdb, eks, etc&hellip;)</li>
<li><code>kms_account_key_id</code> &ndash; The <a href="https://docs.aws.amazon.com/kms/latest/developerguide/find-cmk-id-arn.html">ID</a> of the default
KMS key (sometimes things need the ID, sometimes the ARN, so we&rsquo;re giving both)</li>
<li><code>vpc_id</code> &ndash; The ID of the <a href="https://docs.aws.amazon.com/vpc/latest/userguide/what-is-amazon-vpc.html">VPC</a> we created for
this environment</li>
<li><code>private_subnet_ids</code> &ndash; The IDs of the private <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Subnets.html">subnets</a>
we setup for your environment</li>
<li><code>public_subnets_ids</code> &ndash; The IDs of the public <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Subnets.html">subnets</a>
we setup for your environment</li>
</ul>
<h2 id="aws-dns">aws-dns</h2>
<p>This module creates a <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/hosted-zones-working-with.html">Route53 hosted zone</a> for
your given domain. The <a href="#k8s-base">k8s-base</a> module automatically hooks up the load balancer to it
for the domain and subdomain specified, but in order for this to actually receive traffic you will need to complete
the <a href="/docs/tutorials/ingress">dns setup</a>.</p>
<p><em>Fields</em></p>
<ul>
<li>domain &ndash; Required. The domain you want (you will also get the subdomains for your use)</li>
<li>delegated &ndash; Optional. Set to true once the extra dns setup is complete.</li>
</ul>
<p><em>Outputs</em></p>
<ul>
<li>zone_id &ndash; The ID of the hosted zone created</li>
<li>name_servers &ndash; The name servers of your hosted zone (very important for the dns setup)</li>
<li>domain &ndash; The domain again</li>
<li>cert_arn &ndash; The arn of the <a href="https://docs.aws.amazon.com/acm/latest/userguide/acm-overview.html">ACM certificate </a> which
is used for ssl.</li>
</ul>
<h2 id="aws-eks">aws-eks</h2>
<p>This module creates an <a href="https://docs.aws.amazon.com/eks/latest/userguide/what-is-eks.html">EKS cluster</a>, and a default
nodegroup to host your applications in. This needs to be added in the environment opta yml if you wish to deploy services
as opta services run on Kubernetes.</p>
<p><em>Fields</em></p>
<ul>
<li><code>min_nodes</code> &ndash; Optional. The minimum number of nodes to be set by the autoscaler in for the default nodegroup. Defaults to 3.</li>
<li><code>max_nodes</code> &ndash; Optional. The minimum number of nodes to be set by the autoscaler in for the default nodegroup. Defaults to 5.</li>
<li><code>node_disk_size</code> &ndash; Optional. The size of disk to give the nodes' ec2s. Defaults to 20(GB)</li>
<li><code>node_instance_type</code> &ndash; Optional. The <a href="https://aws.amazon.com/ec2/instance-types/">ec2 instance type</a> for the nodes. Defaults
to t3.medium (highly unrecommended to set to smaller)</li>
<li><code>k8s_version</code> &ndash; Optional. The Kubernetes version for the cluster. Must be <a href="https://docs.aws.amazon.com/eks/latest/userguide/kubernetes-versions.html">supported by EKS</a></li>
</ul>
<h2 id="k8s-base">k8s-base</h2>
<p>This module is responsible for all the base infrastructure we package into the opta K8s environments. This includes:</p>
<ul>
<li><a href="https://github.com/kubernetes/autoscaler">Autoscaler</a> for scaling up and down the ec2s as needed</li>
<li><a href="https://github.com/kubernetes-sigs/external-dns">External DNS</a> to automatically hook up the ingress to the hosted zone and its domain</li>
<li><a href="https://github.com/kubernetes/ingress-nginx">Ingress Nginx</a> to expose services to the public</li>
<li><a href="https://github.com/kubernetes-sigs/metrics-server">Metrics server</a> for scaling different deployments based on cpu/memory usage</li>
<li><a href="https://linkerd.io/">Linkerd</a> as our service mesh.</li>
</ul>
<p><em>Fields</em>
None for the user, we allow no configuration at the time.</p>
<p><em>Outputs</em>
None</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b02d26f6c20395131bdf4246898f743a">1.2 - GCP environment modules</h1>
    
	<h2 id="gcp-base">gcp-base</h2>
<p>This module is the &ldquo;base&rdquo; module for creating an environment in gcp. It sets up the VPC, private subnet, firewall,
default kms key, private service access, and activate the container registry. Defaults are set to work 99% of the time, assuming no funny
networking constraints (you&rsquo;ll know them if you have them), so <em>no need to set any of the fields or know what the outputs do</em>.</p>
<p><em>Fields</em></p>
<ul>
<li><code>private_ipv4_cidr_block</code> &ndash; Optional. This is the cidr block for VM instances in the VPC. Defaults to &ldquo;10.0.0.0/19&rdquo;</li>
<li><code>cluster_ipv4_cidr_block</code> &ndash; Optional. This is the cidr block reserved for pod ips in the GKE cluster. Defaults to &ldquo;10.0.32.0/19&rdquo;</li>
<li><code>services_ipv4_cidr_block</code> &ndash; Optional This is the cidr block reserved for service cluster ips in the GKE cluster. Defaults to &ldquo;10.0.64.0/20&rdquo;</li>
</ul>
<p><em>Outputs</em></p>
<ul>
<li>kms_account_key_id &ndash; The id of the <a href="https://cloud.google.com/security-key-management">KMS</a> key (this is what handles
encryption for redis, gke, etc&hellip;)</li>
<li>kms_account_key_self_link &ndash; The self link of the default
KMS key (sometimes things need the ID, sometimes the ARN, so we&rsquo;re giving both)</li>
<li>vpc_id &ndash; The ID of the <a href="https://cloud.google.com/vpc/docs/vpc">VPC</a> we created for this environment</li>
<li>private_subnet_id &ndash; The ID of the private <a href="https://cloud.google.com/vpc/docs/vpc#subnet-ranges">subnets</a>
we setup for your environment</li>
</ul>
<h2 id="gcp-dns">gcp-dns</h2>
<p>This module creates a GCP <a href="https://cloud.google.com/dns/docs/zones">managed zone</a> for
your given domain. The <a href="#k8s-base">k8s-base</a> module automatically hooks up the load balancer to it
for the domain and subdomain specified, but in order for this to actually receive traffic you will need to complete
the <a href="/docs/tutorials/ingress">dns setup</a>.</p>
<p><em>Fields</em></p>
<ul>
<li>domain &ndash; Required. The domain you want (you will also get the subdomains for your use)</li>
<li>delegated &ndash; Optional. Set to true once the extra dns setup is complete and it will add the ssl certs.</li>
<li>subdomains &ndash; Optional. A list of subdomains to also get ssl certs for.</li>
</ul>
<p><em>Outputs</em></p>
<ul>
<li>zone_id &ndash; The ID of the hosted zone created</li>
<li>name_servers &ndash; The name servers of your hosted zone (very important for the dns setup)</li>
<li>domain &ndash; The domain again</li>
<li>cert_arn &ndash; The arn of the <a href="https://docs.aws.amazon.com/acm/latest/userguide/acm-overview.html">ACM certificate </a> which
is used for ssl.</li>
</ul>
<h2 id="gcp-gke">gcp-gke</h2>
<p>This module creates an <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/kubernetes-engine-overview">GKE cluster</a>, and a default
node pool to host your applications in. This needs to be added in the environment opta yml if you wish to deploy services
as opta services run on Kubernetes.</p>
<p><em>Fields</em></p>
<ul>
<li><code>min_nodes</code> &ndash; Optional. The minimum number of nodes to be set by the autoscaler in for the default nodegroup. Defaults to 3.</li>
<li><code>max_nodes</code> &ndash; Optional. The minimum number of nodes to be set by the autoscaler in for the default nodegroup. Defaults to 5.</li>
<li><code>node_disk_size</code> &ndash; Optional. The size of disk to give the nodes' ec2s. Defaults to 20(GB)</li>
<li><code>node_instance_type</code> &ndash; Optional. The <a href="https://cloud.google.com/compute/docs/machine-types">gcloud machine type</a> for the nodes. Defaults
to n2-highcpu-4 (highly unrecommended to set to smaller)</li>
<li><code>gke_channel</code> &ndash; Optional. The GKE K8s <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/release-channels">release channel</a>
to bind the cluster too. Gives you automatic K8s version management for the lcuster and node pools. Defaults to &ldquo;REGULAR&rdquo;</li>
</ul>
<h2 id="gcp-k8s-base">gcp-k8s-base</h2>
<p>This module is responsible for all the base infrastructure we package into the opta K8s environments. This includes:</p>
<ul>
<li><a href="https://github.com/kubernetes/ingress-nginx">Ingress Nginx</a> to expose services to the public</li>
<li><a href="https://linkerd.io/">Linkerd</a> as our service mesh.</li>
<li>A custom load balancer and dns routing built to handle the Ingress Nginx which we set up.
<em>Fields</em>
None for the user, we allow no configuration at the time.</li>
</ul>
<p><em>Outputs</em>
None</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3525fa571dc1c25f855af7e3f2060b89">1.3 - Cloud agnostic environment modules</h1>
    
	<h2 id="datadog">datadog</h2>
<p>This module setups the <a href="https://docs.datadoghq.com/agent/kubernetes/?tab=helm">Datadog Kubernetes</a> integration onto
the EKS cluster created for this environment. Please read the <a href="/docs/tutorials/datadog">datadog tutorial</a> for all the
details of the features.</p>
<p><em>Fields</em>
None. It&rsquo;ll prompt the use for a valid api key the first time it&rsquo;s run, but nothing else, and nothing in the yaml.</p>
<p><em>Outputs</em>
None</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-17f62f7e9a70bad68895e6447344b83a">2 - Service modules</h1>
    
	<p>This section provides the list of module types for the user to use in an service opta yaml (referencing one or more environments), with their inputs and outputs.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-d13b5dc21fdb391688377e7ca5945001">2.1 - AWS service modules</h1>
    
	<h2 id="aws-documentdb">aws-documentdb</h2>
<p>This module creates an AWS Documentdb  cluster. It is made in the private subnets automatically created for the environment.
macro and so can only be accessed in the VPC or through some proxy (e.g. VPN). It is encrypted
at rest with a kms key created in the env setup and in transit via tls.</p>
<p><em>Fields</em></p>
<ul>
<li><code>instance_class</code> &ndash; Optional. This is the RDS instance type used for the documentdb cluster <a href="https://aws.amazon.com/documentdb/pricing/">instances</a>.
Default db.r5.large</li>
</ul>
<p><em>Linking</em></p>
<p>When linked to a k8s-service, this adds connection credentials to your container&rsquo;s environment variables as:</p>
<ul>
<li><code>{module_name}_db_user</code></li>
<li><code>{module_name}_db_password</code></li>
<li><code>{module_name}_db_host</code></li>
</ul>
<p>In the above example file, the <em>{module_name}</em> would be replaced with <code>docdb</code></p>
<p>In addition to these credentials, you also need to enable SSL encryption when
connecting (<a href="https://docs.aws.amazon.com/documentdb/latest/developerguide/connect_programmatically.html">AWS docs</a>).
Fortunately, the Opta k8s-service module has already taken care of that. On linking, you&rsquo;ll
find the AWS CA at <code>/config/rds_ca.pem</code></p>
<p>As an example, this is how the mongoose/node connection looks like:</p>
<pre><code>await mongoose.connect(&quot;mongodb://&lt;USER&gt;:&lt;PASSWORD&gt;@&lt;HOST&gt;, {
  ssl: true,
  sslCA: require('fs').readFileSync(`/config/rds_ca.pem`)
});
</code></pre><h2 id="aws-postgres">aws-postgres</h2>
<p>This module creates a postgres Aurora RDS database instance. It is made in the
private subnets automatically created during environment setup and so can only be accessed in the
VPC or through some proxy (e.g. VPN).</p>
<p><em>Fields</em></p>
<ul>
<li><code>instance_class</code> &ndash; Optional. This is the RDS instance type used for the Aurora cluster <a href="https://aws.amazon.com/rds/instance-types/">instances</a>.
Default db.r5.large</li>
<li><code>engine_version</code> &ndash; Optional. The version of the database to use. Default 11.9.</li>
</ul>
<p><em>Linking</em></p>
<p>When linked to a k8s-service, it adds connection credentials to your container&rsquo;s environment variables as:</p>
<ul>
<li><code>{module_name}_db_user</code></li>
<li><code>{module_name}_db_password</code></li>
<li><code>{module_name}_db_name</code></li>
<li><code>{module_name}_db_host</code></li>
</ul>
<p>In the above example file, the <em>{module_name}</em> would be replaced with <code>rds</code></p>
<p>The permission list is to be empty because we currently do not support giving
apps IAM permissions to manipulate a database.</p>
<h2 id="aws-redis">aws-redis</h2>
<p>This module creates a redis cache via elasticache. It is made with one failover instance across azs, and is encrypted
at rest with a kms key created in the env setup via the <em>init</em> macro and in transit via tls. It is made in the private
subnets created by the _init macro and so can only be accessed in the VPC or through some proxy (e.g. VPN).</p>
<p><em>Fields</em></p>
<ul>
<li><code>node_type</code> &ndash; Optional. This is the redis instance type used for the <a href="https://aws.amazon.com/elasticache/pricing/">instances</a>.
Default cache.m4.large.</li>
</ul>
<p><em>Linking</em></p>
<p>When linked to a k8s-service, it adds connection credentials to your container&rsquo;s environment variables</p>
<ul>
<li><code>{module_name}_cache_auth_token</code> &ndash; The auth token/password of the cluster.</li>
<li><code>{module_name}_cache_host</code> &ndash; The host to contact to access the cluster.</li>
</ul>
<p>In the above example file, the <em>{module_name}</em> would be replaced with <code>redis</code></p>
<p><em>NOTE</em> Redis CLI will not work against this cluster because redis cli does not
support the TLS transit encryption. There should be no trouble with any of the
language sdks however, as they all support TLS.</p>
<h2 id="aws-s3">aws-s3</h2>
<p>This module creates an S3 bucket for storage purposes. It is created with server-side AES256 encryption.</p>
<p><em>Fields</em></p>
<ul>
<li><code>bucket_name</code>&ndash; Required. The name of the bucket to create.</li>
<li><code>block_public</code> &ndash; Optional. Block all public access. Default true</li>
<li><code>bucket_policy</code> &ndash; Optional. A custom s3 policy json/yaml to add.</li>
</ul>
<p><em>Outputs</em></p>
<ul>
<li><code>bucket_id</code> &ndash; The id/name of the bucket.</li>
<li><code>bucket_arn</code> &ndash; The arn of the bucket.</li>
</ul>
<p><em>Linking</em></p>
<p>When linked to a k8s-service, this adds the necessary IAM permissions to read
(e.g. list objects and get objects) and/or write (e.g. list, get,
create, destroy, and update objects) to the given s3 bucket.
The current permissions are, &ldquo;read&rdquo; and &ldquo;write&rdquo;. These need to be
specified when you add the link.</p>
<h2 id="k8s-service">k8s-service</h2>
<p>The most important module for deploying apps, k8s-service deploys a kubernetes app.
It deploys your service as a rolling update securely and with simple autoscaling right off the bat&ndash; you
can even expose it to the world, complete with load balancing both internally and externally.</p>
<p><em>Fields</em></p>
<ul>
<li><code>port</code> &ndash; Required. Specifies what port your app was made to be listened to. Currently it must be a map of the form
<code>http: [PORT_NUMBER_HERE]</code> or <code>tcp: [PORT_NUMBER_HERE]</code>. Use http if you just have a vanilla http server and tcp for
websockets.</li>
<li><code>min_containers</code> &ndash; Optional. The minimum number of replicas your app can autoscale to. Default 1</li>
<li><code>max_containers</code> &ndash; Optional. The maximum number of replicas your app can autoscale to. Default 3</li>
<li><code>image</code> &ndash; Required. Set to AUTO to create a private repo for your own images. Otherwises attempts to pull image from public dockerhub</li>
<li><code>env_vars</code> &ndash; Optional. A list of maps holding name+value fields for envars to add to your container
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">FLAG</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div></li>
<li><code>secrets</code> &ndash; Optional. Same format as env_vars, but these values will be stored in the secrets resource, not directly
in the pod spec.</li>
<li><code>autoscaling_target_cpu_percentage</code> &ndash;  Optional. See the <a href="#autoscaling">autoscaling</a> section. Default 80</li>
<li><code>autoscaling_target_mem_percentage</code> &ndash; Optional. See the <a href="#autoscaling">autoscaling</a> section. Default 80</li>
<li><code>healthcheck_path</code> &ndash; Optional. See the See the <a href="#livenessreadiness-probe">liveness/readiness</a> section. Default &ldquo;/healthcheck&rdquo;</li>
<li><code>resource_request</code> &ndash; Optional. See the <a href="#container-resources">container resources</a> section. Default
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">cpu</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># in millicores</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">128</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># in megabytes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>CPU is given in millicores, and Memory is in megabytes.</p>
</li>
<li><code>public_uri</code> &ndash; Optional. The full domain to expose your app under as well as path prefix. Must be the full parent domain or a subdomain referencing the parent as such: &ldquo;dummy.{parent[domain]}/my/path/prefix&rdquo;</li>
<li><code>additional_iam_policies</code> &ndash; Optional. A list of extra IAM role policies not captured by Opta which you wish to give to your service.</li>
</ul>
<p><em>Outputs</em></p>
<ul>
<li><code>docker_repo_url</code> &ndash; The url of the docker repo created to host this app&rsquo;s images in this environment. Does not exist
when using external images.</li>
</ul>
<h4 id="externalinternal-image">External/Internal Image</h4>
<p>Furthermore, this module supports deploying from an &ldquo;external&rdquo; image repository (currently only public ones supported)
by setting the <code>image</code> field to the repo (e.g. &ldquo;kennethreitz/httpbin&rdquo; in the examples). If you set the value to &ldquo;AUTO&rdquo; however,
it will automatically create a secure container repository with ECR on your account. You can then use the <code>opta push</code>
command to push to it!</p>
<h4 id="healthcheck-probe">Healthcheck Probe</h4>
<p>One of the benefits of K8s is that it comes with built in checks for the responsiveness of your server. These are called
<a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/"><em>liveness</em> and <em>readiness</em> probes</a>.</p>
<p>tl;dr A liveness probe determines whether your server should be restarted, and readiness probe determines if traffic should
be sent to a replica or be temporarily rerouted to other replicas. Essentially smart healthchecks. Opta requires the
user to have such health check endpoints for all http apps (a hello world get endpoint would do) but for websockets it
just checks the tcp connection on the given port.</p>
<h4 id="autoscaling">Autoscaling</h4>
<p>As mentioned, autoscaling is available out of the box. We currently only support autoscaling
based on the pod&rsquo;s cpu and memory usage, but we hope to soon offer the ability to use 3rd party metrics like datadog
to scale. As mentioned in the k8s docs, the horizontal pod autoscaler (which is what we use) assumes a linear relationship between # of replicas
and cpu (twice the replicas means half expected cpu usage), which works well assuming low overhead.
The autoscaler then uses this logic to try and balance the cpu/memory usage at the percentage of request. So, for example,
if the target memory is 80% and we requested 100mb, then it&rsquo;ll try to keep the memory usage at 80mb. If it finds that
the average memory usage was 160mb, it would logically try to double the number of replicas.</p>
<h4 id="container-resources">Container Resources</h4>
<p>One of the other benefits of kubernetes is that a user can have fine control over the <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">resources used by each of their containers</a>.
A user can control the cpu, memory and disk usage with which scheduling is made, and the max limit after which the container is killed.
With Opta, we expose such settings to the user, while keeping sensible defaults.</p>
<p><em>NOTE</em> We expose the resource requests and set the limits to twice the request values.</p>
<h4 id="ingress">Ingress</h4>
<p>You can control if and how you want to expose your app to the world! Check out
the <a href="/docs/tutorials/ingress">Ingress</a> docs for more details.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0f95dcc211c00d06f7f821a5c6acfcf1">2.2 - GCP service modules</h1>
    
	<h2 id="gcp-gcs">gcp-gcs</h2>
<p>This module creates an gcs bucket for storage purposes. It is created with encryption based on the default kms key
created for you in the base, as well as the standard AES-256 encryption.</p>
<p><em>Fields</em></p>
<ul>
<li><code>bucket_name</code>&ndash; Required. The name of the bucket to create.</li>
<li><code>block_public</code> &ndash; Optional. Block all public access. Default true</li>
</ul>
<p><em>Outputs</em></p>
<ul>
<li><code>bucket_id</code> &ndash; The id of the bucket.</li>
<li><code>bucket_name</code> &ndash; The name of the bucket.</li>
</ul>
<p><em>Linking</em></p>
<p>When linked to a gcp-k8s-service, this adds the necessary IAM permissions to read
(e.g. list objects and get objects) and/or write (e.g. list, get,
create, destroy, and update objects) to the given gcs bucket.
The current permissions are, &ldquo;read&rdquo; and &ldquo;write&rdquo;. These need to be
specified when you add the link.</p>
<h2 id="gcp-postgres">gcp-postgres</h2>
<p>This module creates a postgres <a href="https://cloud.google.com/sql/docs/introduction">GCP Cloud SQL</a> database. It is made with
the <a href="https://cloud.google.com/vpc/docs/private-services-access">private service access</a>, ensuring private communication.</p>
<p><em>Fields</em></p>
<ul>
<li><code>instance_tier</code> &ndash; Optional. This is the RDS instance type used for the cloud sql instance <a href="https://cloud.google.com/sql/pricing">instances</a>.
Default &ldquo;db-f1-micro&rdquo;</li>
<li><code>engine_version</code> &ndash; Optional. The major version of the database to use. Default 11</li>
</ul>
<p><em>Linking</em></p>
<p>When linked to a k8s-service, it adds connection credentials to your container&rsquo;s environment variables as:</p>
<ul>
<li><code>{module_name}_db_user</code></li>
<li><code>{module_name}_db_password</code></li>
<li><code>{module_name}_db_name</code></li>
<li><code>{module_name}_db_host</code></li>
</ul>
<p>In the above example file, the <em>{module_name}</em> would be replaced with <code>rds</code></p>
<p>The permission list is to be empty because we currently do not support giving
apps IAM permissions to manipulate a database.</p>
<h2 id="gcp-redis">gcp-redis</h2>
<p>This module creates a redis cache via <a href="https://cloud.google.com/memorystore/docs/redis/redis-overview">Memorystore</a>.
It is made with their standard high availability offering, but (unlike in AWS) there is no
<a href="https://stackoverflow.com/questions/58032778/gcp-cloud-memorystore-data-encryption-at-rest">encryption at rest</a>
and in-transit encryption is not offered as terraform support is in beta. It is made in the with private service access
ensuring private communication.</p>
<p><em>Fields</em></p>
<ul>
<li><code>node_type</code> &ndash; Optional. This is the redis instance type used for the <a href="https://aws.amazon.com/elasticache/pricing/">instances</a>.
Default cache.m4.large.</li>
<li><code>redis_version</code> - the Memorystore offered redis version to use. Default REDIS_5_0</li>
</ul>
<p><em>Linking</em></p>
<p>When linked to a k8s-service, it adds connection credentials to your container&rsquo;s environment variables</p>
<ul>
<li><code>{module_name}_cache_auth_token</code> &ndash; The auth token/password of the cluster.</li>
<li><code>{module_name}_cache_host</code> &ndash; The host to contact to access the cluster.</li>
</ul>
<p>In the above example file, the <em>{module_name}</em> would be replaced with <code>redis</code></p>
<h2 id="gcp-k8s-service">gcp-k8s-service</h2>
<p>The most important module for deploying apps, gcp-k8s-service deploys a kubernetes app on gcp.
It deploys your service as a rolling update securely and with simple autoscaling right off the bat&ndash; you
can even expose it to the world, complete with load balancing both internally and externally.</p>
<p><em>Note</em>: This is nigh-identical to the original AWS version, save that (due to the new IAM method) it is not possible to pass in
IAM permissions at the moment. This will be addressed in accordance to need from users.</p>
<p><em>Fields</em></p>
<ul>
<li><code>port</code> &ndash; Required. Specifies what port your app was made to be listened to. Currently it must be a map of the form
<code>http: [PORT_NUMBER_HERE]</code> or <code>tcp: [PORT_NUMBER_HERE]</code>. Use http if you just have a vanilla http server and tcp for
websockets.</li>
<li><code>min_containers</code> &ndash; Optional. The minimum number of replicas your app can autoscale to. Default 1</li>
<li><code>max_containers</code> &ndash; Optional. The maximum number of replicas your app can autoscale to. Default 3</li>
<li><code>image</code> &ndash; Required. Set to AUTO to create a private repo for your own images. Otherwises attempts to pull image from public dockerhub</li>
<li><code>env_vars</code> &ndash; Optional. A list of maps holding name+value fields for envars to add to your container
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">FLAG</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">value</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;true&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div></li>
<li><code>secrets</code> &ndash; Optional. Same format as env_vars, but these values will be stored in the secrets resource, not directly
in the pod spec.</li>
<li><code>autoscaling_target_cpu_percentage</code> &ndash;  Optional. See the <a href="#autoscaling">autoscaling</a> section. Default 80</li>
<li><code>autoscaling_target_mem_percentage</code> &ndash; Optional. See the <a href="#autoscaling">autoscaling</a> section. Default 80</li>
<li><code>healthcheck_path</code> &ndash; Optional. See the See the <a href="#livenessreadiness-probe">liveness/readiness</a> section. Default &ldquo;/healthcheck&rdquo;</li>
<li><code>resource_request</code> &ndash; Optional. See the <a href="#container-resources">container resources</a> section. Default
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">cpu</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># in millicores</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">memory</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">128</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># in megabytes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>CPU is given in millicores, and Memory is in megabytes.</p>
</li>
<li><code>public_uri</code> &ndash; Optional. The full domain to expose your app under as well as path prefix. Must be the full parent domain or a subdomain referencing the parent as such: &ldquo;dummy.{parent[domain]}/my/path/prefix&rdquo;</li>
</ul>
<p><em>Outputs</em></p>
<ul>
<li><code>docker_repo_url</code> &ndash; The url of the docker repo created to host this app&rsquo;s images in this environment. Does not exist
when using external images.</li>
</ul>

</div>



    
	
  

    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="User support list" aria-label="User support list">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="support@runx.dev">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://join.slack.com/share/zt-m55nvh0w-8V7HAqdHKHEUAU40K2h~BQ">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 RunX Labs Inc. All Rights Reserved</small>
        <small class="ml-1"><a href="https://policies.google.com/privacy" target="_blank">Privacy Policy</a></small>
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>











<script src="/js/main.min.b5fc1b29d2465835844254bd4d804738eaf24c0cec53009b4c6899989be55a47.js" integrity="sha256-tfwbKdJGWDWEQlS9TYBHOOryTAzsUwCbTGiZmJvlWkc=" crossorigin="anonymous"></script>



<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
        apiKey: '45a325ff63b40a0ee70998f1049e20c3',
        indexName: 'runx',
        inputSelector: '.td-search-input',
        debug: false 
    });
</script>



  </body>
</html>
